import { assert } from "chai";
import { Serializer } from "../serializer";
import { HeaderBlock } from "./header_block";

describe('Serializer', () => {
    describe('get_hash()', () => {
        it('Generates header hash correctly', () => {
            // https://www.chiaexplorer.com/blockchain/block/0x5a3c793a73aa5976eca2b3ee8843b7ed63513aa82fcd8d5e94248855ba7f4410
            const rawBlockHeader = "0000000000000000000000000000000062620690000f424000000000000000000000035bce9b2a083cf95b4adb73b66ceee7ae3f27d58224326fbd7870546fe29240c0d49fd697ca65b93f50f96047c5ea75c65d235ccfa97865e7e13cc7c5eb421f3eac13e0f44cf7019544d7144e9c8ff8883874df7015d3006f0197db299b8fc26b27a01fc027ed0a7867c4bcaa059d810a1b045030445bc50082021925c0c13d44af5677d2b23f0654761a809d430dd9f006215aeea634cda66f3d31d03fca6064db8b12c9e6e040072000000100f8bf451f25b0f74a1a2057e14dade69072b858a44c0b93556792cd47352c718aa6b17851f0654cd99a4d2220f1560bca1937f19be6d52f2d7d692ae5ce85fcc9980177333707edd9ba4a4a74b523a1711eb4743263f8d554d7c13fb76aa3d724f001263cc981adae4084a67f8805478fce5e162235f8b2ab2e95e90e2dc5b247dff3219384d229398bbb4b5e53f01f2faa82c8a6769aafecc888ded3a4c89ee3ad1f96527e40abff2480a6c15c0007468b4aa16da09738fc6235a71af54a3efcec81870a338be9b610079d5e3863e5fbae7d2f4486617426c1ec7b84dc35543c2929aedb416cf008d2ed082c6467144b03da65bd369b51c7383d7f035252b69001f95b4adb73b66ceee7ae3f27d58224326fbd7870546fe29240c0d49fd697ca6500000000078f000003005640df8473e23461e82615f304c32b64ef51bef22a3f71b87074d5d659ab355094e682fdd8415538c3ff89c662b5a50cf3b8b2b4b76535b2810c056660198d1c9910aa3a33b3480f395cefd6ce9f262b25945c9c1381e4b762c456e00e587d090100b5fc9674e3aebad54cc0af9ae5fcb390806cb205f0ebc13f22bb72172b77e4db16c6b7d954503ec640f9cc0974915ce611dbcae7cdbb96edfe846de07151b6f38549456766ec57f9f1fe0d67d3e0d650cbb41ddfd01affd036a78d77a9d6e4c0f95b4adb73b66ceee7ae3f27d58224326fbd7870546fe29240c0d49fd697ca6500000000080b2a0801002ab75fac74e8eb741caf7f52d668cd954fad2d575690fc7a4ea7a2f7a154c4049d629ceb188ab7ececc648385e027d7dc014c0305d62dbbc3701e707b9a9cd352b04b8eea62723fade372abac6a95f153912271259c00ec7b05884d46a583f61010001aea89880977ce6886770538249e5a985e2d29cf44963a4ffd6a3ee1bfb14f198000000000081a4380300837b95b730208477c960a31d0f6e5ed9f6f61c0e938171aaf4bd2a6fcc327f2ce7bf254925da3ed9069fb9bb67c39f07254bc924e05f1442f8597fa8c60dc5055d6364b4486d62291fbbf469de074de6a2f53d8ef8ae8da4c6430f4a818631000e0bb564a9fab0fc3a98466a37a12849cc107c5683c9c3e2de3f1247aade9a1d7159406dc43e9ddffd59cd82caf0e744b44d0581edcc057f42a43d7f604142411d942979bad9c76ff09f12d6d2dc8c0e33fc1b12013deed33d9fa69379f05d99e0e98ab5e8ad6523361ddd03762fe764750ef24cf717db0ac52c0ad3ed02e7c7c98c000000000040cf9a00000a922104ed4029a4b51cc2225dcfdde59452520ee2d5083b5f8d9130cd9b09b3dcb3a2ad562317e5fa37159f29d07c37873474fa97c93a6280abe3d8e626af0b03592760d3c25fbe445a17d54a2561b02578fdb09bb2844ea577b509363c100f01000165200959d5f7598084c42ac574a3aa6132d60d2312e4fbf520931b01931b93ac000000000040cf9a0200851cd06e5eb056fbee17c146535874486d8c114dcbb2ebb0a69d89071eb6f6f1602ec82e9d85e6dad7d9882cc7618c6afb5e4da6b37db2502f7acf0f61a59d09e9bd138c915c0017ed71b1e9569d0f93e54950659fd30cf71a290e190b82f30604010001020000017e00006cf963c4a1c634da083278aaf4ae29261d6491477496d9eec6b0304b2a167d19cd4004da0a401f50dcdf1730dcd5808e6eccd160afa08f06410495cae5f2ea285d8e300985cb878dc8947f59f49b862effb56297e7151b6f1714a253134d8e2f020000000000001ccf00d29e985ac3ad780855ef125b721a8b35ec71ef5b96464558ab217eb813aa268de100006306b52606d01f3a5a8b60f3033a048491a2052425c839048f55ad892d5e292eb468523256e8e1fb728483b582c9c042696543beae20761f4c84e36e3817c102e855e8047f0ab123064833c4c892d8846fc78dc9dad0415d29f871e5dd13370510020000000000566d64dfbe8e97e90645a64f91af1c9413e589f721013e509b91a114d7097a91bb23d01b01003258e798d7dafee1efd7f585c6b65b55cd8b83183c121f3ff00ae4351e9409a1ec08a5656e47264d44503137fbd298eb2d06abf820b60ddf8be28fc9cdd6ea39a7301d8bee7fc9293d6205093271ed38c740c7ae3901e4f7798975bac2c92e58010000020000017e02006a18dc17ce58d41d12856c23267be5d9edac8efa04fb6018646587aaf42140cb4d8b3fa51c74486162e2110078036cd373d3d136b4495dfb5b47e629439ea5011b2eada81f401e2d899de45e81e45497b7ef32c23ee7986ed4327e63860f6107030100000000000e671c8740cf04e5a2918d2d4dcffe004d832d2c4f6f8354924c3eff3ad47457e2b44cf30300553706573deec7c96407745c7ca541be492e7c8dccc4cc3d327911e3a7e3d2595cc071e3324935b8b08066e10cc66a0776ac009b025c0deafa50a66165e69505aff196849eebfd9f4a2a2ae8bcdccafe157d77a198e6ea239ebcdaab70aae101010000000000002b34f08cdffb41163a690f8fc56f6dad28692438e1354b1852a570edebc12e48208bd4850200bc4f5e8d8537c80c7f3fe33016a496f735246eae8fc6de849111e125baf387dae8cc95f986abd3aee77c948d2b46a28f9ddc483823c379645eb15c923e49722ce5872d2b06594f5674e42a8829acb26d3cc8af57620aa57ba87d10b00dfc9d3401000001020000017e000076add3e2ac32ba086ea4960050749b5de5b27ef081b9393e8785697053e1b441d5dc00f13cc1e2808dc5c7b326246301f4d88143d921e759c13c0c5412d4eb5ba744148fac4672733db533ef3403d2263aa4c476c5a4b4addaebfcdeaf005d67010000000000001ccf00a2950dedd3d11aca337dc712b554ff2ab81b83a08ddfff177e1060924047986cab03005873182b05440b58fbcdaa6d66575d97b1f3f1c66abda44025c01f91da4a9fbce536885fbbd16bf3ca55e496f6aba739949070fe17ed4e75b55a55c669465a09ff53aa40365f5e695603726ad6d4959ef14bd94ba18c885f026a226082000d0f02010000000000566d64e73c27f3ddb24222da4ba04e7fdb24dc1430e394e8e43cc46ffcc12f4cf026a6bd0300818434ea5af98d639b89be98ed33c48c32d82863100896177f0aa34d0100e35c83a7b165f94d9bbd8e1e972491e259b32cc31e5fd2246e398027d503aaa1ac557d52b588b7951152016bcaec5caa8d631ad8fe93c900dc857ebb1bae67488b59010000020000017e01003e988fd8c3cc5574497a5a607e959591510cf465cadc925f7d9321830f00a86c8e2e5f5bbbb747cfb37ae7376ef76b5d0c0d657b7b5d0ff3b364fabd9973e86a3935df1c70f9ba9d13160aa08d0396831b661614f3bf54d8cc391841e8854b15010000000000000e671cede29cf5f75eb0d8620485b991c7563efc540853b7e10681960dadc58e25fdc85900001e5254d223336bd77e16e0fda2610b0f9ede6f870700b800ae82c602dc77124149f4dbfaec91c15fbd39811c88d5e2d35dfbff77e5a782f468e722022a15c9558db0f904633072df45b98f40d42c6ba6e8f1d9d508e0f44da0db748a5e0a0204010000000000002b34f0a975d94c34f1b26095341d1e3058223fcb996eb528dea34c6401cb017469bc219d0300780c6267c827fc2d4fa6fba07c274375dc35907eebee579d766af84c5ec7047017cac661c5a3a7e1d817b338794d1fec562f5f07ae8adc1e393d2c65480dc1272303215f4617070a044bc5ec92a4f307afdc0673fabc9dcb12d2b663be797f5601000001020000017e0000e9d113f2fa348f5ff1e7f7863094d738697e0e7d98006f3c15aea68d32eb1ffeaaf395d8d98f03603ea9ef35b031ba5cf978894ae81cae818f412aaa7c21fe43a3f7291fb4dcb9e5edc19ad018aea6012db96b56b2abc7b624c0cc7cced37148010000000000000e671c804286505ce850e31029723b32987986562e158ad960939ff84c48d56baef946650300c2a574efbd07dcc846c366c66db6ca67b300b156314c1cb8a53edef73a45cdc19f46e1b5e70f74fec75053fed933af5c87414809008d5214319fe38595349e15a3cffda1b24bb1e6122e64e0d12e9057402bd326b254d520da421d1eab751922010000000000002b34f0a16105f636754b8e943c6b777106cb181274811e02aff362502c6929118b5465cd0000dce72bc9c2b93c0971dfbb5b28c0aef9f1caa186fad742ba02fca3c5731728b37fa5c23c89c17c0d0ff0c94dd48de8fea6f54dccd906e1a175932ed17582c819a7f486f8c9f16cb48ac55315753624d592ec1fda421dcfd8d0adbce5b0b7af01020000f5d672dae94768f8cd119331490b2725d505355522bc81bb7ae314a2d0412b1d37c14f78e779ba0f1f3521cc84ef2a881ec1af4b9b6eeac357c717f013c487afca0d77303f262adf90d7a911afbad1b1c548867af94b5bbe7b203efc380ddefe5b0505e3f90f5ba40a4eb50871b8a3c4f39af795389723286cdebd7706a4bcf5000000000181620e5992e851c1c62ca2d527636fa76344da02dd98283f562b7be153ff0c5c28794ac0a286e8bfa3ac3b65e7ceaddb0defa2148f413ed42c1b665cd8d179dea4c6235f4a74b6aa03fbbe84fb84cdd034afe5220487e0c12ee82807149254425b0505e3f90f5ba40a4eb50871b8a3c4f39af795389723286cdebd7706a4bcf50000000000000000000000000000000000000000000000000000000003a2c7c9b74651c61c97b68a3bd026386e4be75eee3dc757497beb1a5120fff1a824a1c170a2744f700f68cac3d25763def7b3291516c44848140a7d1b9747e065695cf3954a1e741d9ebdd697fb30fff57ea580705469ddeb525abeed33d7b3888f201d000000000000010000";
            const blockHeader: HeaderBlock = Serializer.deserialize(
                HeaderBlock,
                Buffer.from(rawBlockHeader, "hex"),
            );            

            assert.equal(
                blockHeader.headerHash(),
                "5a3c793a73aa5976eca2b3ee8843b7ed63513aa82fcd8d5e94248855ba7f4410"
            );
        });
    });
});