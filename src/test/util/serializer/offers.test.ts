import { assert } from "chai";
import * as greenweb from "../../..";
import { SpendBundle } from "../../../util/serializer/types/spend_bundle";

// 1 Marmot Ticket (https://marvelousmarmots.com/) for 313337 mojos
// eslint-disable-next-line max-len
const OFFER_ENCODED = "offer1qqp83w76wzru6cmqvpsxygqqz6wmkl7tdje0sxkfedqa6ae4pa0kpyq3zc24a902we30lrynhslk5jnqafsvzwj6e7xavuar7hwxs0fhtt8s6apaquh0v9s5m5aep48ww0jl92sajvtycj8ttzuvu5vmj9ecd8hc7jzs26m0wn0mjq64ymamm70kkwwk0jnt6066amwadafk52ket03v806ha5hlh8uapewqkt9psh5x3hgfalfrzsnyzmktj4356ln02lml352hwlaha2jc24vudl4kvc46z0s6fc9qwpt4slfw2ryjd2wapatjjzm785j8xwmu7ewurkv83aaggnpeygah6ede6lncqwuvnnlehxzlzzssce8puj32pkvmwwlte6fc0t7ud9mfku76vzrgm6k4ww857r724u67pt706v62xfd4c5m5u7hdha9pvhr2mh7x8vpzvwa9uc0dsu6dgjgwndzncg7q7uzae5lx7022w57ec777vzpnwnymykmwe3y3j2e2v00hhu0mj27d4p28n4wsljp025sr7yfjw4talvz29m3lkmgr8yvhlmm7el8jzhx3hrwqtgdjq606l7p9mrcuj00w7r0talw9xewz8e3ejc80q7yhjwcllly2c04h4r4w0l87etl564vep4sft2etj6mlhwt9fcxmuv09tlwg28wn447v7nvulvumdeargz4tdplzv0h0ln0v9fhypffklutke2y5euer50d8yrhgfvlmmedunl0t3m8an30ssqnjk2ups9mc8nqdpxsz47llpvf08l5ynskn77k7l2c8tnn9a9d48egv0eky6ety0g2tzjrgu8fh7k3durq9c0d9hwrn2mj85lgvv8hdv5dutpzm7lm9ecl6wc7h06getv57hnlufv2dyt4ufuukl8rtkfqlkdnn44wzfeutkhdh7kr204ykswew7gl8z4wf7674zyfj8f5e8ta4m4c865mfrmu0538jxyhndxd9rutrma6whkeecxgqnakdn6s3q0vx5";
// eslint-disable-next-line max-len
const OFFER_COMPRESSED = "000278bbda7087cd63606060622000169dbb7fcb6cb2f81ac9cb41dd77350f5f60901116155e95ea7662ff8c93bc3f6a4a60ea60c13a5acf8dd673a3f5dc683d375acf0d743d072ef61614dd3b90d4ee73e5f2aa1d93164c48eb58b8ce519b9173869ef8f485056b6f74dfb9035526fbbdf9f6b39d67ca6bd3f5aeeddd6f536a2ad95be2c3bf57ed2ffb9f9d0e5c0b2ca185e868dd09efd231426416ecb95634d7e6f57f7f8d15777fb7eaa585559c6feb6662ba13e1a4e0a07057587d2e50c926a9dd0f57290b7e3d24733b7cf65dc1d9878f7a844c39223b7d65b9d7e7803b8c9cff9b985f10a10c64e1e4a2a0d99b73bebce9387afdc69769b73da60868dead5738f4f0fcaaf35e0afcfd334a325b5c5374e7aedbf4a165c6addfc63b02263ba5e61ed8734d4490e9b453c23c0f705dcd3e6f3d4a753d9c7bde6083374c9b25b6ecc49192b2a63df7bf1fb92bcda85479d5d0fc82f55203f11327557dfb04a2ee3fb6d0339197fef7ecfcf215cd1b8dc05a1b2069faff825d8f1c93deef0debefdc5365c23e639960ef0789793b1fffc8ac3eb7a8eae7fcfecaff4d55990d6095ab2b96b7fbb9654e0dbe31e55fdc851dd3ad7ccf4d9cfb39b6e7a340aab687e263eeffcdec2a6e40a536ff176ca894cf323a3da720ee84b3fbde5bc9fdeb8ecfd9c5f080272b2b81817783cc0d09a02afbff0b12f3fe849c2d3f7adefab075ce65e95b53e50c7e6c4d65647a14b14868e1d37f5a2de0c05c3da5bb87356e47a7d0c61eed651bc5845bf7f65ce3fa763d77e9195b29ebcffc4b14d22ebc4f396f9c6bb241fb3673ad5c24e78bb5db7f586a7d49683b2ef23e7155c9f6bd5111323a6993afb5dd707d53691ef8fa44f2312f3699a51f163df74ebdb39c19009f6cd9ea";
// eslint-disable-next-line max-len
const OFFER_SERIALIZED = "000000020000000000000000000000000000000000000000000000000000000000000000a2cedfda369317ac19d3528bdd29c3d0001c131513aa6546c8bf98c90df87c740000000000000000ff02ffff01ff02ffff01ff02ff5effff04ff02ffff04ffff04ff05ffff04ffff0bff2cff0580ffff04ff0bff80808080ffff04ffff02ff17ff2f80ffff04ff5fffff04ffff02ff2effff04ff02ffff04ff17ff80808080ffff04ffff0bff82027fff82057fff820b7f80ffff04ff81bfffff04ff82017fffff04ff8202ffffff04ff8205ffffff04ff820bffff80808080808080808080808080ffff04ffff01ffffffff81ca3dff46ff0233ffff3c04ff01ff0181cbffffff02ff02ffff03ff05ffff01ff02ff32ffff04ff02ffff04ff0dffff04ffff0bff22ffff0bff2cff3480ffff0bff22ffff0bff22ffff0bff2cff5c80ff0980ffff0bff22ff0bffff0bff2cff8080808080ff8080808080ffff010b80ff0180ffff02ffff03ff0bffff01ff02ffff03ffff09ffff02ff2effff04ff02ffff04ff13ff80808080ff820b9f80ffff01ff02ff26ffff04ff02ffff04ffff02ff13ffff04ff5fffff04ff17ffff04ff2fffff04ff81bfffff04ff82017fffff04ff1bff8080808080808080ffff04ff82017fff8080808080ffff01ff088080ff0180ffff01ff02ffff03ff17ffff01ff02ffff03ffff20ff81bf80ffff0182017fffff01ff088080ff0180ffff01ff088080ff018080ff0180ffff04ffff04ff05ff2780ffff04ffff10ff0bff5780ff778080ff02ffff03ff05ffff01ff02ffff03ffff09ffff02ffff03ffff09ff11ff7880ffff0159ff8080ff0180ffff01818f80ffff01ff02ff7affff04ff02ffff04ff0dffff04ff0bffff04ffff04ff81b9ff82017980ff808080808080ffff01ff02ff5affff04ff02ffff04ffff02ffff03ffff09ff11ff7880ffff01ff04ff78ffff04ffff02ff36ffff04ff02ffff04ff13ffff04ff29ffff04ffff0bff2cff5b80ffff04ff2bff80808080808080ff398080ffff01ff02ffff03ffff09ff11ff2480ffff01ff04ff24ffff04ffff0bff20ff2980ff398080ffff010980ff018080ff0180ffff04ffff02ffff03ffff09ff11ff7880ffff0159ff8080ff0180ffff04ffff02ff7affff04ff02ffff04ff0dffff04ff0bffff04ff17ff808080808080ff80808080808080ff0180ffff01ff04ff80ffff04ff80ff17808080ff0180ffffff02ffff03ff05ffff01ff04ff09ffff02ff26ffff04ff02ffff04ff0dffff04ff0bff808080808080ffff010b80ff0180ff0bff22ffff0bff2cff5880ffff0bff22ffff0bff22ffff0bff2cff5c80ff0580ffff0bff22ffff02ff32ffff04ff02ffff04ff07ffff04ffff0bff2cff2c80ff8080808080ffff0bff2cff8080808080ffff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff2effff04ff02ffff04ff09ff80808080ffff02ff2effff04ff02ffff04ff0dff8080808080ffff01ff0bff2cff058080ff0180ffff04ffff04ff28ffff04ff5fff808080ffff02ff7effff04ff02ffff04ffff04ffff04ff2fff0580ffff04ff5fff82017f8080ffff04ffff02ff7affff04ff02ffff04ff0bffff04ff05ffff01ff808080808080ffff04ff17ffff04ff81bfffff04ff82017fffff04ffff0bff8204ffffff02ff36ffff04ff02ffff04ff09ffff04ff820affffff04ffff0bff2cff2d80ffff04ff15ff80808080808080ff8216ff80ffff04ff8205ffffff04ff820bffff808080808080808080808080ff02ff2affff04ff02ffff04ff5fffff04ff3bffff04ffff02ffff03ff17ffff01ff09ff2dffff0bff27ffff02ff36ffff04ff02ffff04ff29ffff04ff57ffff04ffff0bff2cff81b980ffff04ff59ff80808080808080ff81b78080ff8080ff0180ffff04ff17ffff04ff05ffff04ff8202ffffff04ffff04ffff04ff24ffff04ffff0bff7cff2fff82017f80ff808080ffff04ffff04ff30ffff04ffff0bff81bfffff0bff7cff15ffff10ff82017fffff11ff8202dfff2b80ff8202ff808080ff808080ff138080ff80808080808080808080ff018080ffff04ffff01a072dec062874cd4d3aab892a0906688a1ae412b0109982e1797a170add88bdcdcffff04ffff01a01df783dbe6b9cc777d672ed6bdbf3c7535198d744c0fbd26fd07fcb9400aa039ffff04ffff01ff02ffff01ff02ff0affff04ff02ffff04ff03ff80808080ffff04ffff01ffff333effff02ffff03ff05ffff01ff04ffff04ff0cffff04ffff02ff1effff04ff02ffff04ff09ff80808080ff808080ffff02ff16ffff04ff02ffff04ff19ffff04ffff02ff0affff04ff02ffff04ff0dff80808080ff808080808080ff8080ff0180ffff02ffff03ff05ffff01ff04ffff04ff08ff0980ffff02ff16ffff04ff02ffff04ff0dffff04ff0bff808080808080ffff010b80ff0180ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff1effff04ff02ffff04ff09ff80808080ffff02ff1effff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ff0180808080ffffa0bcd6729d3cebff4f28a8ddfb852e665678cf868b0202dc5842204020dd13279dffffa0b21abbe1aa2311f5c21cdb579bdd119bc3c5485494c41d97a9774af350dc0109ff8203e8ffffa0b21abbe1aa2311f5c21cdb579bdd119bc3c5485494c41d97a9774af350dc0109808080809372529bb36cf4ec88c5d7d8f496db48941029dd7f20c2e1cfaacf4a200f8f9874698445642d9daeb2f08498dafb33b8509342656dc0bcd6141102cb42609e480000000000079eafff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b0969a16a6c8c4747682bcdff7c4dd1b012279d53137d03ba53017c8c9254d8e105adfe3382e341f1bfee6cfa7a883b132ff018080ff80ffff01ffff33ffa0bae24162efbd568f89bc7a340798a6118df0189eb9e3f8697bcea27af99f8f79ff827a6980ffff33ffa0ab78a7874e46699553d894fe5ed0b8973a4dce919df35d8cf110652b4821e30bff8307244680ffff3cffa0b0791f6a32cb9c705ec84347bdda638faec79cba00e00c6a6a60000db01cd81880ffff3fffa0616efc54cd77c5cf3bc33b6cd31bda951e30f8b5650102e258a212a1e5fe2a848080ff8080ab948b8c055eb88912b18c2ba6b1161385bd8cd60af6d76da5cc3d1a3bf30fa42066d0ef64cf336d34b02bdb037d1e5909e8adb7f8392af46086c714ef61aa74b7bd5a581c2c6693d686d845ec793751ebc863c64a061ca5f0a2e74b65dca703";

/*
OFFER_ENCODED - what you see in .offer files
OFFER_COMPRESSED - bech32m.decode(OFFER_ENCODED)
OFFER_SERIALIZED - decompress_object_with_puzzles(OFFER_COMPRESSED) - https://github.com/Chia-Network/chia-blockchain/blob/protocol_and_cats_rebased/chia/wallet/util/puzzle_compression.py
*/

describe("Offers", () => {
    it("addressToPuzzleHash decodes data correctly", () => {
        // offers are encoded into very long bech32m strings - we need to overwrite the max length attribute to decode them
        const compressed: string = greenweb.util.address.addressToPuzzleHash(OFFER_ENCODED, OFFER_ENCODED.length);

        assert.equal(compressed, OFFER_COMPRESSED);
    });

    it("Serializer.deserialize works correctly with OFFER_SERIALIZED", () => {
        // offers are encoded into very long bech32m strings - we need to overwrite the max length attribute to decode them
        const bundle: SpendBundle = greenweb.util.serializer.deserialize(SpendBundle, OFFER_SERIALIZED);

        // eslint-disable-next-line max-len
        assert.equal(bundle.aggregatedSignature, "ab948b8c055eb88912b18c2ba6b1161385bd8cd60af6d76da5cc3d1a3bf30fa42066d0ef64cf336d34b02bdb037d1e5909e8adb7f8392af46086c714ef61aa74b7bd5a581c2c6693d686d845ec793751ebc863c64a061ca5f0a2e74b65dca703");
        assert.equal(bundle.coinSpends.length, 2);

        assert.equal(bundle.coinSpends[0].coin.parentCoinInfo, "0000000000000000000000000000000000000000000000000000000000000000");
        assert.equal(bundle.coinSpends[0].coin.puzzleHash, "a2cedfda369317ac19d3528bdd29c3d0001c131513aa6546c8bf98c90df87c74");
        assert.equal(bundle.coinSpends[0].coin.amount, 0);

        assert.equal(bundle.coinSpends[1].coin.parentCoinInfo, "9372529bb36cf4ec88c5d7d8f496db48941029dd7f20c2e1cfaacf4a200f8f98");
        assert.equal(bundle.coinSpends[1].coin.puzzleHash, "74698445642d9daeb2f08498dafb33b8509342656dc0bcd6141102cb42609e48");
        assert.equal(bundle.coinSpends[1].coin.amount, 499375); // pre_balance - 313337
    });
});